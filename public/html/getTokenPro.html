<!DOCTYPE html>
<html>
<head>
  <title>Formulaire</title>
</head>
<body>
  <h1>Formulaire de saisie de l'e-mail</h1>
  <form id="emailForm">
    <label for="email">E-mail :</label>
    <input type="email" id="email" name="email" required>
    <br>
    <button type="submit">Envoyer</button>
  </form>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('emailForm').addEventListener('submit', function(event) {
          event.preventDefault();
          
          const email = document.getElementById('email').value;
          const allowedDomains = ['@efrei.net', '@societegenerale.fr', '@gmail.com'];
          let isValidDomain = false;

          for (const domain of allowedDomains) {
            if (email.endsWith(domain)) {
              isValidDomain = true;
              break;
            }
          }

          if (!isValidDomain) {
            alert('Invalid email domain');
            return;
          }

          fetch('/get-email', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email }),
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('Email sent with your inscription token ' + data.email);
              window.location.replace('/registerPro')
            } else {
              alert('Failed to retrieve the email: ' + data.message);
            }
          })
          .catch(error => {
            console.error('Error:', error);
          });
        });
      });
      
  </script>
</body>
</html>